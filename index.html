<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background-image: url(./天氣卡img/下載\ \(9\)-70.png);
            background-repeat: no-repeat;
            background-size: cover;
        }

        .my_card {
            width: 14rem;
            border-radius: 20px;
            box-shadow: 0 0 10px 2px rgb(219, 219, 219);
            text-align: center;
        }

        .card-city {
            font-size: 26px;
            font-weight: bold;
        }

        .card-state {
            font-size: 20px;
            font-weight: 600;
            color: #8F95BF;
        }

        .card-celsius {
            font-size: 24px;
            font-weight:bolder;
            color: #e07f23;
        }
    </style>
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">每日天氣</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText"
                    aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarText">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item area_btn" data-area="all_area">
                            <a class="nav-link active" aria-current="page" href="#">全部縣市</a>
                        </li>
                        <li class="nav-item area_btn" data-area="north_area">
                            <a class="nav-link" href="#">北部</a>
                        </li>
                        <li class="nav-item area_btn" data-area="mid_area">
                            <a class="nav-link" href="#">中部</a>
                        </li>
                        <li class="nav-item area_btn" data-area="south_area">
                            <a class="nav-link" href="#">南部</a>
                        </li>
                        <li class="nav-item area_btn" data-area="east_area">
                            <a class="nav-link" href="#">東部</a>
                        </li>
                        <li class="nav-item area_btn" data-area="outside_area">
                            <a class="nav-link" href="#">外島</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <section class="cards_area row m-0 p-3 justify-content-center">
            <section class="cards_show row col-auto row-cols-2 row-cols-md-4 m-0 gy-4 gap-4 justify-content-start">
                <!-- <div class="my_card card col p-3">
                <img src="./天氣卡img/cloud-wind.png" class="card-img-top" style="width: 100px;margin: auto;" alt="...">
                <div class="card-body">
                    <p class="card-city">縣市</p>
                    <p class="card-celsius">溫度</p>
                    <p class="card-state">晴時有雲</p>
                </div>
            </div> -->
            </section>
        </section>

    </main>
    <footer>

    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script>
        callfetch();
        function callfetch() {
            fetch('https://opendata.cwa.gov.tw/api/v1/rest/datastore/F-C0032-001?Authorization=CWA-88085FAF-7CB2-4FA3-9F3C-56D21069A1EA')
                .then(function (response) {
                    return response.json();
                })
                .then(function (item) {
                    let all_city = item.records.location;
                    console.log(all_city);
                    let citys_name = all_city.filter((all_city) => all_area.includes(all_city.locationName));
                    btn_action(all_city);
                    cards_show(citys_name);
                })
        };

        let all_area = [
            '臺北市', '新北市', '嘉義縣', '嘉義市', '新竹縣', '新竹市', '臺南市', '宜蘭縣', '苗栗縣', '雲林縣', '花蓮縣', '臺中市', '臺東縣', '桃園市', '南投縣', '高雄市', '金門縣', '屏東縣', '基隆市', '澎湖縣', '彰化縣', '連江縣',
        ];
        let north_area = [
            '新北市', '新竹縣', '新竹市', '臺北市', '桃園市', '基隆市', '苗栗縣',
        ];
        let mid_area = [
            '雲林縣', '臺中市', '南投縣', '彰化縣', '嘉義縣', '嘉義市',
        ];
        let south_area = [
            '臺南市', '高雄市', '屏東縣',
        ];
        let east_area = [
            '宜蘭縣', '花蓮縣', '臺東縣',
        ];
        let outside_area = [
            '金門縣', '澎湖縣', '連江縣',
        ];

        //綁定按鈕
        function btn_action(its) {
            let area_btn = document.querySelectorAll('.area_btn');
            area_btn.forEach((btns) => {
                btns.addEventListener('click', function () {
                    if (btns.dataset.area == 'all_area') {
                        let citys_name = its.filter((city) => all_area.includes(city.locationName));
                        cards_show(citys_name);
                    } if (btns.dataset.area == 'north_area') {
                        let citys_name = its.filter((city) => north_area.includes(city.locationName));
                        cards_show(citys_name);
                    } if (btns.dataset.area == 'mid_area') {
                        let citys_name = its.filter((city) => mid_area.includes(city.locationName));
                        cards_show(citys_name);
                    } if (btns.dataset.area == 'south_area') {
                        let citys_name = its.filter((city) => south_area.includes(city.locationName));
                        cards_show(citys_name);
                    } if (btns.dataset.area == 'east_area') {
                        let citys_name = its.filter((city) => east_area.includes(city.locationName));
                        cards_show(citys_name);
                    } if (btns.dataset.area == 'outside_area') {
                        let citys_name = its.filter((city) => outside_area.includes(city.locationName));
                        cards_show(citys_name);
                    }
                });
            });
        };

        function cards_show(citys_name) {
            let cards_show = document.querySelector('.cards_show');
            let img = [];
            cards_show.innerHTML = '';
            citys_name.forEach((showitem) => {
                let min_c = showitem.weatherElement[2].time[0].parameter;
                let max_c = showitem.weatherElement[4].time[0].parameter;
                let wx = showitem.weatherElement[0].time[0].parameter;
                console.log(wx);
                if (wx.parameterName == '晴天') {
                    img = './天氣卡img/sun.png';
                } if (wx.parameterName == '晴時多雲') {
                    img = './天氣卡img/sun-cloud.png';
                } if (wx.parameterName == '多雲時晴') {
                    img = './天氣卡img/cloud.png';
                } if (wx.parameterName == '多雲' || wx.parameterName == '陰時多雲' || wx.parameterName == '陰天') {
                    img = './天氣卡img/clouds.png';
                } if (wx.parameterName == '多雲時晴短暫陣雨' || wx.parameterName == '晴午後短暫雷陣雨' || wx.parameterName == '多雲時晴短暫雨' || wx.parameterName == '晴時多雲短暫陣雨' || wx.parameterName == '晴短暫陣雨' || wx.parameterName == '多雲短暫陣雨' ) {
                    img = './天氣卡img/drizzle.png';
                } if (wx.parameterName == '雷雨' || wx.parameterName == '雷陣雨') {
                    img = './天氣卡img/thunderstorm.png';
                } if (wx.parameterName == '陣雨' || wx.parameterName == '短暫雨' || wx.parameterName == '雨天') {
                    img = './天氣卡img/thunderstorm.png';
                }
                cards_show.innerHTML += `
                <div class="my_card card col p-3">
                    <img src="${img}" class="card-img-top card_img" style="width: 100px;margin: auto;" alt="...">
                    <div class="card-body">
                        <p class="card-city"> ${showitem.locationName}</p>
                        <div class='row m-0 text-center'>
                            <div  class='row col m-0'
                                <p class="col p-0">最低溫
                                <p class="col card-celsius p-0">${min_c.parameterName}°C</p>
                            </div>
                            <div  class='row col m-0'
                                <p class="col p-0">最高溫
                                <p class="col card-celsius p-0">${max_c.parameterName}°C</p>
                            </div>
                        <p class="card-state">${wx.parameterName}</p>
                    </div>
                </div>
            `;
            })
        };

    </script>
</body>

</html>